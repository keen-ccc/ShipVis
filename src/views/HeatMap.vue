<script setup>
import * as d3 from 'd3'
import { ref, onMounted } from 'vue';

// 矩阵数据
//  const matrixData  = Array.from({length:20},()=>
//  Array.from({length:20},()=>Math.random()));
 const matrixData = [[0.0013366633655564485, 0.0013521337838795775, 0.0013660363306790262, 0.0013783192258697726, 0.0013889364219782112, 0.0013978478914936639, 0.0014050198780804193, 0.001410425109447403, 0.0014140429699970973, 0.0014158596317261818, 0.0014158681422148716, 0.001414068468922703, 0.0014104674993953618, 0.0014050789973822223, 0.00139792351525269, 0.0013890282634947497, 0.0013784269384499973, 0.0013661595098139368, 0.0013522719697740175, 0.0013368160459860173], [0.001352137415365004, 0.0013677851737626898, 0.0013818468744403742, 0.001394270144199042, 0.001405008409050365, 0.0014140211848553204, 0.0014212743314038609, 0.0014267402677051906, 0.0014303981465925242, 0.0014322339870933352, 0.0014322407633927344, 0.001430418449596603, 0.0014267740198965584, 0.0014213214041344413, 0.001414081399162875, 0.0014050815367909442, 0.0013943559094864411, 0.0013819449553786525, 0.0013678952044572808, 0.0013522589881952798], [0.0013660415802052893, 0.0013818484724660268, 0.0013960529615057724, 0.001408602141957474, 0.0014194489675366574, 0.001428552544628079, 0.0014358783889367266, 0.0014413986429496334, 0.0014450922522902547, 0.0014469450994057237, 0.0014469500933990379, 0.00144510721520706, 0.0014414235177213752, 0.0014359130808516954, 0.001428596921931694, 0.0014195028622653496, 0.0014086653509960748, 0.001396125247862119, 0.001381929566750602, 0.0013661311823017935], [0.0013783240113230159, 0.001394271237443843, 0.0014086016164823196, 0.0014212617738361302, 0.001432204246904887, 0.0014413877812778587, 0.0014487775896500456, 0.001454345571194983, 0.0014580704894612254, 0.0014599381072148035, 0.001459941277034175, 0.001458079986847165, 0.001454361360007719, 0.0014487996099109715, 0.0014414159495492725, 0.0014322384568154498, 0.0014213018967503006, 0.0014086475023056542, 0.0013943227155571436, 0.001378380891638884], [0.0013889386073871423, 0.0014050068403354881, 0.0014194457381885692, 0.0014322015218025139, 0.001443226369806207, 0.0014524787170289177, 0.001459923515368314, 0.0014655324548090768, 0.0014692841426431778, 0.001471164239306102, 0.0014711655496217916, 0.0014692880686443246, 0.0014655389816899758, 0.00145993261855576, 0.001452490362336375, 0.0014432405136475274, 0.0014322181114636147, 0.0014194647121540131, 0.001405028128668416, 0.0013889621321584588], [0.0013978453025242457, 0.0014140147582957661, 0.0014285443939399524, 0.001441380091993434, 0.0014524737312139478, 0.0014617834868806867, 0.0014692740932921204, 0.0014749170661583883, 0.0014786908829248278, 0.0014805811194330643, 0.0014805805417042889, 0.00147868915202866, 0.0014749141889499207, 0.0014692700811466983, 0.0014617783556183405, 0.001452467500996643, 0.0014413727871923714, 0.0014285360429777685, 0.0014140053934621794, 0.0013978349597683914], [0.0014050103180747813, 0.0014212608286232867, 0.0014358630767541116, 0.0014487626741908452, 0.00145991125985726, 0.0014692668016770042, 0.0014767938603735776, 0.0014824638129586267, 0.001486255033933251, 0.001488153032603927, 0.0014881505452886512, 0.0014862475815958908, 0.0014824514243623277, 0.001476776583251773, 0.0014692447024264705, 0.001459884423114301, 0.0014487312022911545, 0.0014358270890830948, 0.0014212204608623263, 0.0014049657213496883], [0.00141040637585896, 0.0014267174644516686, 0.001441373923217532, 0.0014543211616037427, 0.0014655106396514643, 0.0014749001709129534, 0.0014824541872225485, 0.001488143962996993, 0.0014919477970888808, 0.0014938511505816145, 0.001493846739302924, 0.0014919345802344205, 0.0014881219914024456, 0.0014824235452527198, 0.0014748609759219497, 0.001465463041234517, 0.0014542653406468178, 0.0014413100907527722, 0.001426645860329597, 0.0014103272672477878], [0.0014140128710682968, 0.0014303638295989532, 0.001445055890087012, 0.0014580343290133567, 0.0014692504891707229, 0.0014786620833141665, 0.0014862334595658645, 0.0014919358262451233, 0.0014957474341393993, 0.0014976537146056575, 0.0014976473722730678, 0.0014957284315236731, 0.0014919042363358644, 0.0014861894034938416, 0.0014786057295774978, 0.0014691820525624447, 0.0014579540692585076, 0.0014449641102012036, 0.0014302608739843027, 0.0014138991233620599], [0.001415816003250918, 0.0014321859710235306, 0.0014468948880635704, 0.0014598879677040389, 0.0014711164975721451, 0.0014805381435857969, 0.0014881172156533443, 0.0014938248927455697, 0.0014976394053533477, 0.0014995461737175525, 0.0014995379006033335, 0.0014976146177915128, 0.0014937836858763195, 0.001488059747367582, 0.0014804646335183412, 0.0014710272257039483, 0.0014597832725868512, 0.0014467751646826065, 0.0014320516683168916, 0.0014156676213070108], [0.001415808864227285, 0.0014321769077126748, 0.0014468838715482031, 0.001459874975979901, 0.001471101515763647, 0.0014805211641193959, 0.0014880982383864438, 0.001493803925048882, 0.001497616462146753, 0.0014995212774583622, 0.001499511081225722, 0.001497585912599795, 0.001493753139389735, 0.0014880274111202974, 0.0014804305658138086, 0.0014709914913279604, 0.0014597459424792575, 0.0014467363155710943, 0.0014320113823170029, 0.0014156259854893687], [0.0014139914821518957, 0.001430336675208102, 0.001445022883580137, 0.0014579954044606346, 0.001469205602001514, 0.0014786112108360532, 0.0014861766013501666, 0.0014918730043748248, 0.0014956786933160993, 0.00149757912211362, 0.0014975670177994106, 0.0014956424268366833, 0.0014918127148217035, 0.0014860925195556273, 0.0014785036579017577, 0.001469074987256917, 0.0014578422228692068, 0.0014448477126166996, 0.001430140171235117, 0.001413774376325362], [0.001410370821328027, 0.0014266723253742236, 0.0014413190555564684, 0.0014542564557534898, 0.0014654360215139524, 0.001474815602760571, 0.0014823596683389583, 0.0014880395300895628, 0.001491833524466103, 0.0014937271500934683, 0.0014937131600426257, 0.0014917916080027308, 0.0014879698479383196, 0.001482262487233681, 0.0014746912937446267, 0.0014652850575815122, 0.0014540794088533195, 0.0014411165929843364, 0.0014264452055861377, 0.0014101198892107242], [0.0014049607377781045, 0.0014211978814097036, 0.0014357865617369975, 0.001448672438502886, 0.001459807200151108, 0.001469148865328744, 0.001476662046376983, 0.0014823181724990583, 0.0014860956706368455, 0.0014879801024530689, 0.0014879642562067395, 0.0014860481927000202, 0.0014822392448902042, 0.001476551971168299, 0.0014690080627224576, 0.0014596362058083047, 0.0014484719001504553, 0.0014355572350836785, 0.0014209406254044271, 0.001404676509255619], [0.0013977818909654545, 0.0014139342485036254, 0.0014284465289377617, 0.001441264676228579, 0.0014523406324766896, 0.0014616326378443613, 0.0014691054926566503, 0.001474730779384913, 0.0014784870425535277, 0.0014803599249762743, 0.0014803422591145145, 0.0014784341127432282, 0.0014746427885180473, 0.0014689827774475677, 0.0014614756666844657, 0.0014521500024578982, 0.0014410411093620222, 0.0014281908676013874, 0.0014136474501579971, 0.0013974650221856963], [0.0013888616124537864, 0.0014049090809338473, 0.0014193269022207903, 0.0014320613717647892, 0.0014430647451201698, 0.0014522955359117088, 0.0014597187762214745, 0.0014653062371107872, 0.0014690366073345279, 0.0014708956286607104, 0.0014708761866003897, 0.0014689783557348807, 0.0014652093992395191, 0.0014595837226073134, 0.001452122781985134, 0.0014428549479375587, 0.0014318153258478154, 0.0014190455345476994, 0.001404593445125203, 0.0013885128822050407], [0.0013782337326725637, 0.0013941566067873679, 0.0014084622677715982, 0.0014210974285047548, 0.0014320147166030405, 0.001441172970064632, 0.0014485374956228578, 0.0014540802875373238, 0.0014577802048933864, 0.0014596231058432833, 0.0014596019375935295, 0.0014577167813402312, 0.0014539748517498005, 0.0014483904509921906, 0.0014409848777348943, 0.0014317862919058905, 0.0014208295364303329, 0.0014081559175150255, 0.0013938129454203457, 0.0013778540379938847], [0.0013659383673227993, 0.0013817174118558493, 0.0013958936345355667, 0.00140841423003518, 0.0014192322552369933, 0.0014283069222008474, 0.0014356038541696353, 0.0014410953023659544, 0.0014447603216660517, 0.0014465849035962648, 0.0014465620654732227, 0.0014446918948914714, 0.0014409815491639437, 0.001435445209721161, 0.0014281039918717293, 0.0014189858107324397, 0.0014081252045132734, 0.0013955631167251376, 0.0013813466392297068, 0.0013655287183852861], [0.0013520216653105685, 0.001367638184617226, 0.0013816681765410122, 0.0013940593801063962, 0.0014047653370560232, 0.0014137456817955101, 0.0014209663947498496, 0.0014264000169068116, 0.0014300258236579534, 0.0014318299563957587, 0.001431805510698348, 0.0014299525803201795, 0.001426278256593013, 0.0014207965832442465, 0.0014135284670353254, 0.0014045015450153142, 0.0013937500095673665, 0.001381314392797885, 0.0013672413121698249, 0.0013515831796100638], [0.0013365355204215045, 0.0013519714245401667, 0.0013658389381726208, 0.0013780864052227056, 0.0013886679060814884, 0.0013975435442115409, 0.00140467969656068, 0.0014100492256052546, 0.0014136316511570738, 0.0014154132804073336, 0.0014153872950584806, 0.0014135537947643443, 0.0014099197964941067, 0.0014044991898246118, 0.0013973126485597532, 0.0013883874994633865, 0.001377757549270434, 0.0013654628715097132, 0.0013515495550149798, 0.001336069416334349]]
 const geojson = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{},"geometry":{"coordinates":[[[119,35],[119,24],[130,24],[130,35],[119,35]]],"type":"Polygon"},"id":0}]}
 // console.log(matrixData)
const mapContainer = ref(null)
// 获取heatmap容器的引用
const heatmapContainer = ref(null)
// 在组件加载后执行D3.js绘图逻辑
onMounted(()=>{
    // console.log(heatmapContainer.value)
    renderMap()
    renderHeatMap()
})
const renderMap = () =>{
    const width = 600
    const height = 600

    const svg = d3.select(mapContainer.value)
    .attr('width',width)
    .attr('height',height)

    // 墨卡托投影函数
    const projection = d3.geoMercator()
    .center([124.5,29.5])
    .scale(1000)
    .translate([width/2,height/2])

    const path = d3.geoPath().projection(projection)
    
    svg.selectAll('path')
    .data(geojson.features)
    .enter().append('path')
    .attr('d',path)
    .attr('fill','red')
    .attr('opacity','0.5')

}
const renderHeatMap = () =>{
    const width = 500
    const height = 500

    // const colors = colorsTable.map(([value, ...color]) => d3.rgb(...color.map(d => d * 255)));
    const colorScale = d3.scaleSequential(d3.interpolateRgbBasis(['#ecf5d7', '#2c7da7'])).domain([0.00130, 0.00150]);

    const svg = d3.select(heatmapContainer.value)
    .append('svg')
    .attr('width',width)
    .attr('height',height)

    svg.selectAll('rect')
    .data(matrixData.flat())
    .enter()
    .append('rect')
    .attr('x',(d,i)=>(i % 20)*(width/20))
    .attr('y',(d,i)=>Math.floor(i / 20)*(height/20))
    .attr('width',width/20 -0.5)  
    .attr('height',height/20 -0.5)
    .attr('fill',d => {
        const color = colorScale(d)
        // console.log(color)
        return color
    })
    .attr('stroke',d => {
        const color = colorScale(d)
        return color
    })
    // .attr('stroke-width',0)
}
</script>
<template>
    <svg ref="mapContainer">
        
    </svg>
    <!-- <div ref="heatmapContainer">
        
    </div> -->

</template>
<style scoped>

</style>